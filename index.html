<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Viperwave</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Major+Mono+Display&display=swap" rel="stylesheet">
    <style>
        /* CSS com tema Cyberpunk / Viperwave */
        :root {
            --cor-fundo-1: #0d0221;
            --cor-fundo-2: #241b47;
            --cor-grade: #ff00c1;
            --cor-cobra-1: #adff00;
            --cor-cobra-2: #00a878;
            --cor-texto: #00f5d4;
            --cor-texto-sombra: #ff00c1;
            --tamanho-grid: 21; /* Usar n√∫mero √≠mpar ajuda a centralizar */
        }

        @keyframes backgroundShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        @keyframes textGlitch {
            0%, 100% { text-shadow: -1.5px -1.5px 0 var(--cor-texto-sombra), 1.5px 1.5px 0 var(--cor-texto); }
            25% { text-shadow: 1.5px 1.5px 0 var(--cor-texto-sombra), -1.5px -1.5px 0 var(--cor-texto); }
            50% { text-shadow: -1.5px 1.5px 0 var(--cor-texto-sombra), 1.5px -1.5px 0 var(--cor-texto); }
            75% { text-shadow: 1.5px -1.5px 0 var(--cor-texto-sombra), -1.5px 1.5px 0 var(--cor-texto); }
        }

        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background: linear-gradient(270deg, var(--cor-fundo-1), var(--cor-fundo-2), var(--cor-fundo-1));
            background-size: 600% 600%;
            animation: backgroundShift 15s ease infinite;
            font-family: 'Major Mono Display', monospace;
            color: var(--cor-texto);
            flex-direction: column;
            overflow: hidden;
        }
        
        /* Efeito de Scanlines (tela antiga) */
        body::after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(0deg, rgba(0,0,0,0.3), rgba(0,0,0,0.3) 1px, transparent 1px, transparent 3px);
            pointer-events: none;
            z-index: 100;
        }

        h1 {
            font-size: 3rem;
            animation: textGlitch 0.25s infinite;
        }
        
        #game-board {
            display: grid;
            grid-template-rows: repeat(var(--tamanho-grid), 1fr);
            grid-template-columns: repeat(var(--tamanho-grid), 1fr);
            width: 90vmin;
            height: 90vmin;
            max-width: 600px;
            max-height: 600px;
            background-color: transparent;
            /* Grade de neon feita com background-image */
            background-image: 
                linear-gradient(to right, var(--cor-grade) 1px, transparent 1px),
                linear-gradient(to bottom, var(--cor-grade) 1px, transparent 1px);
            background-size: calc(100% / var(--tamanho-grid)) calc(100% / var(--tamanho-grid));
            border: 2px solid var(--cor-grade);
            box-shadow: 0 0 20px var(--cor-grade), inset 0 0 20px var(--cor-grade);
            border-radius: 5px;
        }

        .snake {
            /* Textura de "escamas" com gradiente */
            background-color: var(--cor-cobra-2);
            background-image: repeating-linear-gradient(45deg, var(--cor-cobra-1) 0, var(--cor-cobra-1) 1px, var(--cor-cobra-2) 1px, var(--cor-cobra-2) 3px);
            box-shadow: 0 0 8px var(--cor-cobra-1);
            border-radius: 2px;
        }

        .snake-head {
            background: var(--cor-cobra-1); /* Cabe√ßa com cor s√≥lida para destaque */
            z-index: 2;
        }

        .food {
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: calc(50vmin / var(--tamanho-grid)); /* Tamanho da ma√ß√£ responsivo */
            filter: drop-shadow(0 0 3px #ff0000); /* Sombra para o emoji */
            transform: scale(1.1);
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
        }

        .score-container {
            font-size: 1.5rem;
            margin-bottom: 10px;
            text-shadow: 0 0 5px var(--cor-texto-sombra);
        }

        #score {
            color: var(--cor-cobra-1);
            font-size: 1.8rem;
        }

        /* Estilos para os bot√µes de toque */
        .touch-btn {
            background: var(--cor-grade);
            color: var(--cor-fundo-1);
            font-size: 2rem;
            border: none;
            border-radius: 8px;
            box-shadow: 0 0 8px var(--cor-grade);
            padding: 18px 28px;
            margin: 0;
            font-family: inherit;
            cursor: pointer;
            transition: background 0.2s;
        }

        .touch-btn:active {
            background: var(--cor-cobra-1);
            color: var(--cor-fundo-2);
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Viperwave</h1>
        <div class="score-container">SCORE: <span id="score">0</span></div>
    </div>

    <!-- Controles de toque para celular -->
    <div id="touch-controls" style="display: none;">
        <div style="display: flex; flex-direction: column; align-items: center; gap: 10px;">
            <button class="touch-btn" data-dir="up">‚ñ≤</button>
            <div style="display: flex; gap: 10px;">
                <button class="touch-btn" data-dir="left">‚óÄ</button>
                <button class="touch-btn" data-dir="down">‚ñº</button>
                <button class="touch-btn" data-dir="right">‚ñ∂</button>
            </div>
        </div>
    </div>
    
    <div id="game-board"></div>
    
    <button id="toggle-ai" style="margin-bottom: 15px; font-size: 1.2rem; background: var(--cor-grade); color: var(--cor-fundo-1); border-radius: 8px; border: none; padding: 10px 18px; cursor: pointer; box-shadow: 0 0 8px var(--cor-grade);">Ativar IA</button>

    <audio id="background-music" loop>
        <source src="https://cdn.pixabay.com/download/audio/2023/01/18/audio_623812d116.mp3" type="audio/mpeg">
    </audio>

    <script>
        // --- CONFIGURA√á√ïES GERAIS ---
        const GRID_SIZE = 21; // Mesmo valor do CSS
        const STARTING_SPEED = 200; // Come√ßa um pouco mais devagar
        const gameBoard = document.getElementById('game-board');
        const scoreDisplay = document.getElementById('score');
        const music = document.getElementById('background-music');
        
        let snake = [{ x: 11, y: 11 }]; // Posi√ß√£o inicial no centro
        let food = generateFood();
        let direction = { x: 0, y: 0 };
        let score = 0;
        let gameRunning = true;
        let gameStarted = false;
        let gameSpeed = STARTING_SPEED;

        // --- L√ìGICA DO JOGO ---
        function main() {
            if (!gameRunning) {
                music.pause();
                alert(`// SYSTEM FAILURE // SCORE: ${score}. PRESS OK TO REBOOT.`);
                window.location.reload();
                return;
            }
            if (aiEnabled) aiMove();
            update();
            draw();
        }

        function update() {
            const head = { x: snake[0].x + direction.x, y: snake[0].y + direction.y };
            snake.unshift(head);

            if (head.x === food.x && head.y === food.y) {
                score++;
                scoreDisplay.innerText = score;
                food = generateFood();
                if (gameSpeed > 70) { // Aumenta a velocidade at√© um limite
                    gameSpeed -= 5;
                    clearInterval(gameInterval);
                    gameInterval = setInterval(main, gameSpeed);
                }
            } else {
                snake.pop();
            }

            if (checkCollision(head)) {
                gameRunning = false;
            }
        }

        function draw() {
            gameBoard.innerHTML = '';
            // Desenha a cobra
            snake.forEach((segment, index) => {
                const snakeElement = document.createElement('div');
                snakeElement.style.gridRowStart = segment.y;
                snakeElement.style.gridColumnStart = segment.x;
                snakeElement.classList.add('snake');
                if (index === 0) snakeElement.classList.add('snake-head');
                gameBoard.appendChild(snakeElement);
            });

            // Desenha a comida (ma√ß√£)
            const foodElement = document.createElement('div');
            foodElement.style.gridRowStart = food.y;
            foodElement.style.gridColumnStart = food.x;
            foodElement.classList.add('food');
            foodElement.innerText = 'üçé'; // Usando o emoji da ma√ß√£
            gameBoard.appendChild(foodElement);
        }

        function generateFood() {
            let newFoodPosition;
            while (newFoodPosition == null || onSnake(newFoodPosition)) {
                newFoodPosition = {
                    x: Math.floor(Math.random() * GRID_SIZE) + 1,
                    y: Math.floor(Math.random() * GRID_SIZE) + 1
                };
            }
            return newFoodPosition;
        }

        function onSnake(position) {
            return snake.some(segment => segment.x === position.x && segment.y === position.y);
        }

        function checkCollision(head) {
            const hitWall = head.x < 1 || head.x > GRID_SIZE || head.y < 1 || head.y > GRID_SIZE;
            const hitSelf = snake.slice(1).some(segment => segment.x === head.x && segment.y === head.y);
            return hitWall || hitSelf;
        }

        // --- CONTROLES E M√öSICA ---
        function startGame() {
            if (!gameStarted) {
                music.volume = 0.5; // M√∫sica um pouco mais baixa
                music.play().catch(e => console.log("Aguardando intera√ß√£o do usu√°rio para tocar a m√∫sica."));
                gameStarted = true;
            }
        }
        
        window.addEventListener('keydown', e => {
            if (!gameStarted) startGame();
            
            switch (e.key) {
                case 'ArrowUp': if (direction.y === 0) direction = { x: 0, y: -1 }; break;
                case 'ArrowDown': if (direction.y === 0) direction = { x: 0, y: 1 }; break;
                case 'ArrowLeft': if (direction.x === 0) direction = { x: -1, y: 0 }; break;
                case 'ArrowRight': if (direction.x === 0) direction = { x: 1, y: 0 }; break;
            }
        });

        // --- IN√çCIO ---
        let gameInterval = setInterval(main, gameSpeed);

        // --- CONTROLES DE TOQUE (M√ìVEL) ---
        const touchControls = document.getElementById('touch-controls');
        const touchButtons = document.querySelectorAll('.touch-btn');

        // Mostrar controles de toque se em um dispositivo m√≥vel
        function isMobile() {
            return /Android|iPhone|iPad|iPod|Opera Mini|IEMobile|Mobile/i.test(navigator.userAgent);
        }

        if (isMobile()) {
            document.getElementById('touch-controls').style.display = 'block';
        }

        document.querySelectorAll('.touch-btn').forEach(btn => {
            btn.addEventListener('touchstart', e => {
                e.preventDefault();
                startGame();
                const dir = btn.getAttribute('data-dir');
                switch (dir) {
                    case 'up':    if (direction.y === 0) direction = { x: 0, y: -1 }; break;
                    case 'down':  if (direction.y === 0) direction = { x: 0, y: 1 }; break;
                    case 'left':  if (direction.x === 0) direction = { x: -1, y: 0 }; break;
                    case 'right': if (direction.x === 0) direction = { x: 1, y: 0 }; break;
                }
            });
        });

        let aiEnabled = false;
        const aiButton = document.getElementById('toggle-ai');
        aiButton.addEventListener('click', () => {
            aiEnabled = !aiEnabled;
            aiButton.innerText = aiEnabled ? "Desativar IA" : "Ativar IA";
        });

        // Fun√ß√£o IA aprimorada: evita colis√£o com a cauda
        function aiMove() {
            const head = snake[0];
            const possibleMoves = [
                { x: 0, y: -1, name: 'up' },
                { x: 0, y: 1, name: 'down' },
                { x: -1, y: 0, name: 'left' },
                { x: 1, y: 0, name: 'right' }
            ];

            // Prioriza movimentos que aproximam da comida
            possibleMoves.sort((a, b) => {
                const distA = Math.abs((head.x + a.x) - food.x) + Math.abs((head.y + a.y) - food.y);
                const distB = Math.abs((head.x + b.x) - food.x) + Math.abs((head.y + b.y) - food.y);
                return distA - distB;
            });

            for (const move of possibleMoves) {
                // Evita revers√£o de dire√ß√£o
                if ((move.x === -direction.x && move.y === -direction.y)) continue;
                const nextPos = { x: head.x + move.x, y: head.y + move.y };
                // Verifica se o pr√≥ximo movimento √© seguro
                if (
                    nextPos.x >= 1 && nextPos.x <= GRID_SIZE &&
                    nextPos.y >= 1 && nextPos.y <= GRID_SIZE &&
                    !snake.some(segment => segment.x === nextPos.x && segment.y === nextPos.y)
                ) {
                    direction = { x: move.x, y: move.y };
                    break;
                }
            }
        }
    </script>
</body>
</html>