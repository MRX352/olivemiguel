<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cesar Lattes 2002</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Major+Mono+Display&display=swap" rel="stylesheet">
    <style>
        /* CSS com tema Cyberpunk / Viperwave */
        :root {
            --cor-fundo-1: #0d0221;
            --cor-fundo-2: #241b47;
            --cor-grade: #ff00c1;
            --cor-cobra-1: #adff00;
            --cor-cobra-2: #00a878;
            --cor-texto: #00f5d4;
            --cor-texto-sombra: #ff00c1;
            --tamanho-grid: 21; /* Usar número ímpar ajuda a centralizar */
        }

        @keyframes backgroundShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        @keyframes textGlitch {
            0%, 100% { text-shadow: -1.5px -1.5px 0 var(--cor-texto-sombra), 1.5px 1.5px 0 var(--cor-texto); }
            25% { text-shadow: 1.5px 1.5px 0 var(--cor-texto-sombra), -1.5px -1.5px 0 var(--cor-texto); }
            50% { text-shadow: -1.5px 1.5px 0 var(--cor-texto-sombra), 1.5px -1.5px 0 var(--cor-texto); }
            75% { text-shadow: 1.5px -1.5px 0 var(--cor-texto-sombra), -1.5px 1.5px 0 var(--cor-texto); }
        }

        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background: linear-gradient(270deg, var(--cor-fundo-1), var(--cor-fundo-2), var(--cor-fundo-1));
            background-size: 600% 600%;
            animation: backgroundShift 15s ease infinite;
            font-family: 'Major Mono Display', monospace;
            color: var(--cor-texto);
            flex-direction: column;
            overflow: hidden;
        }
        
        /* Efeito de Scanlines (tela antiga) */
        body::after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(0deg, rgba(0,0,0,0.3), rgba(0,0,0,0.3) 1px, transparent 1px, transparent 3px);
            pointer-events: none;
            z-index: 100;
        }

        h1 {
            font-size: 3rem;
            animation: textGlitch 0.25s infinite;
        }
        
        #game-board {
            display: grid;
            grid-template-rows: repeat(var(--tamanho-grid), 1fr);
            grid-template-columns: repeat(var(--tamanho-grid), 1fr);
            width: 90vmin;
            height: 90vmin;
            max-width: 600px;
            max-height: 600px;
            background-color: transparent;
            /* Grade de neon feita com background-image */
            background-image: 
                linear-gradient(to right, var(--cor-grade) 1px, transparent 1px),
                linear-gradient(to bottom, var(--cor-grade) 1px, transparent 1px);
            background-size: calc(100% / var(--tamanho-grid)) calc(100% / var(--tamanho-grid));
            border: 2px solid var(--cor-grade);
            box-shadow: 0 0 20px var(--cor-grade), inset 0 0 20px var(--cor-grade);
            border-radius: 5px;
        }

        .snake {
            /* Efeito de volume com gradiente radial */
            background: radial-gradient(circle at 60% 40%, #adff00 60%, #00a878 100%);
            box-shadow: 0 0 12px #adff00, 0 0 2px #00a878 inset;
            border-radius: 50%;
            position: relative;
            z-index: 1;
            transition: box-shadow 0.2s;
        }

        .snake-head {
            background: radial-gradient(circle at 60% 40%, #eaff7b 70%, #adff00 100%);
            border-radius: 50%;
            box-shadow: 0 0 18px #eaff7b, 0 0 4px #adff00 inset;
            position: relative;
            z-index: 2;
        }

        /* Olhos da cobra */
        .snake-head .eye {
            position: absolute;
            width: 18%;
            height: 18%;
            background: #222;
            border-radius: 50%;
            top: 30%;
            left: 20%;
            z-index: 3;
        }

        .snake-head .eye.right {
            left: auto;
            right: 20%;
        }

        .food {
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: calc(50vmin / var(--tamanho-grid)); /* Tamanho da maçã responsivo */
            filter: drop-shadow(0 0 3px #ff0000); /* Sombra para o emoji */
            transform: scale(1.1);
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
        }

        .score-container {
            font-size: 1.5rem;
            margin-bottom: 10px;
            text-shadow: 0 0 5px var(--cor-texto-sombra);
        }

        #score {
            color: var(--cor-cobra-1);
            font-size: 1.8rem;
        }

        /* Estilos para os botões de toque */
        .touch-btn {
            background: var(--cor-grade);
            color: var(--cor-fundo-1);
            font-size: 2rem;
            border: none;
            border-radius: 8px;
            box-shadow: 0 0 8px var(--cor-grade);
            padding: 18px 28px;
            margin: 0;
            font-family: inherit;
            cursor: pointer;
            transition: background 0.2s;
        }

        .touch-btn:active {
            background: var(--cor-cobra-1);
            color: var(--cor-fundo-2);
        }

        /* Estilos do menu de personalização */
        #custom-menu {
            position: absolute;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(13, 2, 33, 0.98);
            z-index: 999;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        #custom-menu h2 {
            color: var(--cor-texto);
            text-shadow: 0 0 8px var(--cor-grade);
            margin-bottom: 18px;
        }

        #animal-select, #color-picker {
            font-size: 1.1rem;
            padding: 6px 12px;
            border-radius: 6px;
            margin-right: 10px;
        }

        #animal-preview {
            width: 120px;
            height: 120px;
            margin-bottom: 24px;
            display: flex;
            justify-content: center;
            align-items: center;
            border: 2px solid var(--cor-grade);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
        }

        #start-btn {
            font-size: 1.3rem;
            background: var(--cor-grade);
            color: var(--cor-fundo-1);
            border-radius: 8px;
            border: none;
            padding: 12px 28px;
            cursor: pointer;
            box-shadow: 0 0 8px var(--cor-grade);
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Cesar Lattes 2002</h1>
        <div class="score-container">SCORE: <span id="score">0</span></div>
    </div>

    <!-- Controles de toque para celular -->
    <div id="touch-controls" style="display: none;">
        <div style="display: flex; flex-direction: column; align-items: center; gap: 10px;">
            <button class="touch-btn" data-dir="up">▲</button>
            <div style="display: flex; gap: 10px;">
                <button class="touch-btn" data-dir="left">◀</button>
                <button class="touch-btn" data-dir="down">▼</button>
                <button class="touch-btn" data-dir="right">▶</button>
            </div>
        </div>
    </div>
    
    <div id="game-board"></div>
    
    <button id="toggle-ai" style="margin-bottom: 15px; font-size: 1.2rem; background: var(--cor-grade); color: var(--cor-fundo-1); border-radius: 8px; border: none; padding: 10px 18px; cursor: pointer; box-shadow: 0 0 8px var(--cor-grade);">Ativar IA</button>

    <!-- Menu de Personalização -->
    <div id="custom-menu" style="position: absolute; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(13,2,33,0.98); z-index: 999; display: flex; flex-direction: column; align-items: center; justify-content: center;">
        <h2 style="color: var(--cor-texto); text-shadow: 0 0 8px var(--cor-grade); margin-bottom: 18px;">Personalize seu Animal</h2>
        <div style="display: flex; gap: 32px; margin-bottom: 24px;">
            <!-- Escolha de Animal -->
            <div>
                <label style="color: var(--cor-texto); font-size: 1.2rem;">Animal:</label>
                <select id="animal-select" style="font-size: 1.1rem; padding: 6px 12px; border-radius: 6px;">
                    <option value="snake">Cobra</option>
                    <option value="worm">Minhoca</option>
                    <option value="lizard">Lagarto</option>
                    <option value="frog">Sapo</option>
                </select>
            </div>
            <!-- Escolha de Cor -->
            <div>
                <label style="color: var(--cor-texto); font-size: 1.2rem;">Cor:</label>
                <input type="color" id="color-picker" value="#adff00" style="width: 48px; height: 32px; border: none; border-radius: 6px;">
            </div>
        </div>
        <!-- Preview do Animal -->
        <div id="animal-preview" style="width: 120px; height: 120px; margin-bottom: 24px;"></div>
        <button id="start-btn" style="font-size: 1.3rem; background: var(--cor-grade); color: var(--cor-fundo-1); border-radius: 8px; border: none; padding: 12px 28px; cursor: pointer; box-shadow: 0 0 8px var(--cor-grade);">Iniciar Jogo</button>
    </div>

    <audio id="background-music" loop>
        <source src="https://cdn.pixabay.com/download/audio/2023/01/18/audio_623812d116.mp3" type="audio/mpeg">
    </audio>

    <script>
        // --- CONFIGURAÇÕES GERAIS ---
        const GRID_SIZE = 21; // Mesmo valor do CSS
        const STARTING_SPEED = 200; // Começa um pouco mais devagar
        const gameBoard = document.getElementById('game-board');
        const scoreDisplay = document.getElementById('score');
        const music = document.getElementById('background-music');
        
        let snake = [{ x: 11, y: 11 }]; // Posição inicial no centro
        let food = generateFood();
        let direction = { x: 0, y: 0 };
        let score = 0;
        let gameRunning = false; // Só libera após clicar em "Iniciar Jogo"
        let gameStarted = false;
        let gameSpeed = STARTING_SPEED;

        // Personalização do animal
        const customMenu = document.getElementById('custom-menu');
        const startBtn = document.getElementById('start-btn');
        const animalSelect = document.getElementById('animal-select');
        const colorPicker = document.getElementById('color-picker');
        const animalPreview = document.getElementById('animal-preview');

        // --- PERSONALIZAÇÃO ---
        let selectedAnimal = 'snake';
        let selectedColor = '#adff00';

        function renderAnimalPreview(animal, color) {
            let html = '';
            if (animal === 'snake') {
                html = `
                    <div style="position:relative;width:100px;height:100px;">
                        <div style="position:absolute;left:30px;top:40px;width:40px;height:40px;background:${color};border-radius:50%;box-shadow:0 0 12px ${color};"></div>
                        <div style="position:absolute;left:45px;top:55px;width:10px;height:10px;background:#222;border-radius:50%;"></div>
                        <div style="position:absolute;left:65px;top:55px;width:10px;height:10px;background:#222;border-radius:50%;"></div>
                        <div style="position:absolute;left:50px;top:80px;width:2px;height:18px;background:#e22;border-radius:2px;"></div>
                    </div>
                `;
            } else if (animal === 'worm') {
                html = `
                    <div style="position:relative;width:100px;height:100px;">
                        <div style="position:absolute;left:40px;top:60px;width:40px;height:20px;background:${color};border-radius:20px;"></div>
                        <div style="position:absolute;left:60px;top:65px;width:8px;height:8px;background:#222;border-radius:50%;"></div>
                    </div>
                `;
            } else if (animal === 'lizard') {
                html = `
                    <div style="position:relative;width:100px;height:100px;">
                        <div style="position:absolute;left:35px;top:50px;width:30px;height:18px;background:${color};border-radius:18px 18px 12px 12px/18px 18px 12px 12px;"></div>
                        <div style="position:absolute;left:60px;top:55px;width:12px;height:12px;background:${color};border-radius:50%;"></div>
                        <div style="position:absolute;left:65px;top:60px;width:6px;height:6px;background:#222;border-radius:50%;"></div>
                        <div style="position:absolute;left:40px;top:68px;width:8px;height:18px;background:${color};border-radius:8px;"></div>
                        <div style="position:absolute;left:57px;top:68px;width:8px;height:18px;background:${color};border-radius:8px;"></div>
                    </div>
                `;
            } else if (animal === 'frog') {
                html = `
                    <div style="position:relative;width:100px;height:100px;">
                        <div style="position:absolute;left:40px;top:60px;width:20px;height:20px;background:${color};border-radius:50%;"></div>
                        <div style="position:absolute;left:60px;top:60px;width:20px;height:20px;background:${color};border-radius:50%;"></div>
                        <div style="position:absolute;left:45px;top:65px;width:8px;height:8px;background:#222;border-radius:50%;"></div>
                        <div style="position:absolute;left:67px;top:65px;width:8px;height:8px;background:#222;border-radius:50%;"></div>
                        <div style="position:absolute;left:50px;top:80px;width:20px;height:10px;background:#222;border-radius:10px;"></div>
                    </div>
                `;
            }
            animalPreview.innerHTML = html;
        }
        renderAnimalPreview(selectedAnimal, selectedColor);

        animalSelect.addEventListener('change', e => {
            selectedAnimal = e.target.value;
            renderAnimalPreview(selectedAnimal, selectedColor);
        });
        colorPicker.addEventListener('input', e => {
            selectedColor = e.target.value;
            renderAnimalPreview(selectedAnimal, selectedColor);
        });

        // Só inicia o jogo após clicar em "Iniciar Jogo"
        customMenu.style.display = 'flex';
        startBtn.addEventListener('click', () => {
            customMenu.style.display = 'none';
            document.documentElement.style.setProperty('--cor-cobra-1', selectedColor);
            window.selectedAnimal = selectedAnimal;
            gameRunning = true; // Libera o jogo
        });

        // --- LÓGICA DO JOGO ---
        function main() {
            if (!gameRunning) return;
            if (!gameStarted) {
                music.volume = 0.5;
                music.play().catch(e => {});
                gameStarted = true;
            }
            if (aiEnabled) aiMove();
            update();
            draw();
        }

        function update() {
            const head = { x: snake[0].x + direction.x, y: snake[0].y + direction.y };
            snake.unshift(head);

            if (head.x === food.x && head.y === food.y) {
                score++;
                scoreDisplay.innerText = score;
                food = generateFood();
                if (gameSpeed > 70) { // Aumenta a velocidade até um limite
                    gameSpeed -= 5;
                    clearInterval(gameInterval);
                    gameInterval = setInterval(main, gameSpeed);
                }
            } else {
                snake.pop();
            }

            if (checkCollision(head)) {
                gameRunning = false;
                music.pause();
                alert(`// SYSTEM FAILURE // SCORE: ${score}. PRESS OK TO REBOOT.`);
                window.location.reload();
            }
        }

        function draw() {
            gameBoard.innerHTML = '';
            snake.forEach((segment, index) => {
                const snakeElement = document.createElement('div');
                snakeElement.style.gridRowStart = segment.y;
                snakeElement.style.gridColumnStart = segment.x;

                // Animal customizado
                if (window.selectedAnimal === 'worm') {
                    snakeElement.style.background = selectedColor;
                    snakeElement.style.borderRadius = '20px';
                    snakeElement.style.boxShadow = `0 0 8px ${selectedColor}`;
                } else if (window.selectedAnimal === 'lizard') {
                    snakeElement.style.background = selectedColor;
                    snakeElement.style.borderRadius = '40% 40% 30% 30%/40% 40% 30% 30%';
                    snakeElement.style.boxShadow = `0 0 8px ${selectedColor}`;
                } else if (window.selectedAnimal === 'frog') {
                    snakeElement.style.background = selectedColor;
                    snakeElement.style.borderRadius = '50%';
                    snakeElement.style.boxShadow = `0 0 8px ${selectedColor}`;
                } else {
                    snakeElement.classList.add('snake');
                }

                if (index === 0) {
                    snakeElement.classList.add('snake-head');
                    // Olhos e boca realistas
                    if (window.selectedAnimal === 'frog') {
                        const leftEye = document.createElement('div');
                        leftEye.style.position = 'absolute';
                        leftEye.style.width = '18%';
                        leftEye.style.height = '18%';
                        leftEye.style.background = '#222';
                        leftEye.style.borderRadius = '50%';
                        leftEye.style.top = '30%';
                        leftEye.style.left = '10%';
                        snakeElement.appendChild(leftEye);
                        const rightEye = document.createElement('div');
                        rightEye.style.position = 'absolute';
                        rightEye.style.width = '18%';
                        rightEye.style.height = '18%';
                        rightEye.style.background = '#222';
                        rightEye.style.borderRadius = '50%';
                        rightEye.style.top = '30%';
                        rightEye.style.right = '10%';
                        snakeElement.appendChild(rightEye);
                        // Boca
                        const mouth = document.createElement('div');
                        mouth.style.position = 'absolute';
                        mouth.style.width = '40%';
                        mouth.style.height = '10%';
                        mouth.style.background = '#222';
                        mouth.style.borderRadius = '10px';
                        mouth.style.bottom = '15%';
                        mouth.style.left = '30%';
                        snakeElement.appendChild(mouth);
                    } else if (window.selectedAnimal === 'lizard') {
                        const leftEye = document.createElement('div');
                        leftEye.style.position = 'absolute';
                        leftEye.style.width = '14%';
                        leftEye.style.height = '14%';
                        leftEye.style.background = '#222';
                        leftEye.style.borderRadius = '50%';
                        leftEye.style.top = '28%';
                        leftEye.style.left = '18%';
                        snakeElement.appendChild(leftEye);
                        const rightEye = document.createElement('div');
                        rightEye.style.position = 'absolute';
                        rightEye.style.width = '14%';
                        rightEye.style.height = '14%';
                        rightEye.style.background = '#222';
                        rightEye.style.borderRadius = '50%';
                        rightEye.style.top = '28%';
                        rightEye.style.right = '18%';
                        snakeElement.appendChild(rightEye);
                    } else if (window.selectedAnimal === 'worm') {
                        const eye = document.createElement('div');
                        eye.style.position = 'absolute';
                        eye.style.width = '14%';
                        eye.style.height = '14%';
                        eye.style.background = '#222';
                        eye.style.borderRadius = '50%';
                        eye.style.top = '40%';
                        eye.style.left = '42%';
                        snakeElement.appendChild(eye);
                    } else {
                        // Cobra padrão
                        const leftEye = document.createElement('div');
                        leftEye.classList.add('eye');
                        const rightEye = document.createElement('div');
                        rightEye.classList.add('eye', 'right');
                        snakeElement.appendChild(leftEye);
                        snakeElement.appendChild(rightEye);
                    }
                }
                gameBoard.appendChild(snakeElement);
            });

            // Comida
            const foodElement = document.createElement('div');
            foodElement.style.gridRowStart = food.y;
            foodElement.style.gridColumnStart = food.x;
            foodElement.classList.add('food');
            foodElement.innerText = '🍎';
            gameBoard.appendChild(foodElement);
        }

        function generateFood() {
            let newFoodPosition;
            while (newFoodPosition == null || onSnake(newFoodPosition)) {
                newFoodPosition = {
                    x: Math.floor(Math.random() * GRID_SIZE) + 1,
                    y: Math.floor(Math.random() * GRID_SIZE) + 1
                };
            }
            return newFoodPosition;
        }

        function onSnake(position) {
            return snake.some(segment => segment.x === position.x && segment.y === position.y);
        }

        function checkCollision(head) {
            const hitWall = head.x < 1 || head.x > GRID_SIZE || head.y < 1 || head.y > GRID_SIZE;
            const hitSelf = snake.slice(1).some(segment => segment.x === head.x && segment.y === head.y);
            return hitWall || hitSelf;
        }

        // --- CONTROLES E MÚSICA ---
        function startGame() {
            if (!gameStarted) {
                music.volume = 0.5; // Música um pouco mais baixa
                music.play().catch(e => {});
                gameStarted = true;
            }
        }
        
        window.addEventListener('keydown', e => {
            if (!gameStarted) startGame();
            switch (e.key) {
                case 'ArrowUp': if (direction.y === 0) direction = { x: 0, y: -1 }; break;
                case 'ArrowDown': if (direction.y === 0) direction = { x: 0, y: 1 }; break;
                case 'ArrowLeft': if (direction.x === 0) direction = { x: -1, y: 0 }; break;
                case 'ArrowRight': if (direction.x === 0) direction = { x: 1, y: 0 }; break;
            }
        });

        // Garante que a música toque após qualquer clique/touch do usuário
        document.body.addEventListener('click', () => {
            if (!gameStarted) startGame();
            music.play().catch(() => {});
        });
        document.body.addEventListener('touchstart', () => {
            if (!gameStarted) startGame();
            music.play().catch(() => {});
        });

        // --- INÍCIO ---
        let gameInterval = setInterval(main, gameSpeed);

        // --- CONTROLES DE TOQUE (MÓVEL) ---
        const touchControls = document.getElementById('touch-controls');
        const touchButtons = document.querySelectorAll('.touch-btn');

        // Mostrar controles de toque se em um dispositivo móvel
        function isMobile() {
            return /Android|iPhone|iPad|iPod|Opera Mini|IEMobile|Mobile/i.test(navigator.userAgent);
        }

        if (isMobile()) {
            document.getElementById('touch-controls').style.display = 'block';
        }

        document.querySelectorAll('.touch-btn').forEach(btn => {
            btn.addEventListener('touchstart', e => {
                e.preventDefault();
                startGame();
                const dir = btn.getAttribute('data-dir');
                switch (dir) {
                    case 'up':    if (direction.y === 0) direction = { x: 0, y: -1 }; break;
                    case 'down':  if (direction.y === 0) direction = { x: 0, y: 1 }; break;
                    case 'left':  if (direction.x === 0) direction = { x: -1, y: 0 }; break;
                    case 'right': if (direction.x === 0) direction = { x: 1, y: 0 }; break;
                }
            });
        });

        let aiEnabled = false;
        const aiButton = document.getElementById('toggle-ai');
        aiButton.addEventListener('click', () => {
            aiEnabled = !aiEnabled;
            aiButton.innerText = aiEnabled ? "Desativar IA" : "Ativar IA";
        });

        // Função IA aprimorada: evita colisão com a cauda
        function aiMove() {
            const head = snake[0];
            const possibleMoves = [
                { x: 0, y: -1, name: 'up' },
                { x: 0, y: 1, name: 'down' },
                { x: -1, y: 0, name: 'left' },
                { x: 1, y: 0, name: 'right' }
            ];

            possibleMoves.sort((a, b) => {
                const distA = Math.abs((head.x + a.x) - food.x) + Math.abs((head.y + a.y) - food.y);
                const distB = Math.abs((head.x + b.x) - food.x) + Math.abs((head.y + b.y) - food.y);
                return distA - distB;
            });

            for (const move of possibleMoves) {
                // Evita reversão de direção
                if ((move.x === -direction.x && move.y === -direction.y)) continue;
                const nextPos = { x: head.x + move.x, y: head.y + move.y };
                // Verifica se o próximo movimento é seguro
                if (
                    nextPos.x >= 1 && nextPos.x <= GRID_SIZE &&
                    nextPos.y >= 1 && nextPos.y <= GRID_SIZE &&
                    !snake.some(segment => segment.x === nextPos.x && segment.y === nextPos.y)
                ) {
                    direction = { x: move.x, y: move.y };
                    break;
                }
            }
        }
    </script>
</body>
</html>